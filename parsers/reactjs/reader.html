<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansybl Feed Viewer</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .post { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .input-container { margin-bottom: 15px; }
        img { max-width: 100%; height: auto; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        function FeedViewer() {
            const [feed, setFeed] = React.useState(null);
            const [error, setError] = React.useState(null);
            const [fileUrl, setFileUrl] = React.useState("");
            const [localFile, setLocalFile] = React.useState(null);

            const fetchFeed = () => {
                if (!fileUrl) {
                    setError("Please enter a file URL");
                    return;
                }
                setError(null);
                axios.get(fileUrl)
                    .then(response => setFeed(response.data))
                    .catch(() => setError("Failed to load feed"));
            };

            const handleFileChange = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const json = JSON.parse(e.target.result);
                            setFeed(json);
                        } catch (error) {
                            setError("Invalid JSON file");
                        }
                    };
                    reader.readAsText(file);
                }
            };

            return (
                <div>
                    <div className="input-container">
                        <input 
                            type="text" 
                            placeholder="Enter file URL" 
                            value={fileUrl} 
                            onChange={(e) => setFileUrl(e.target.value)} 
                        />
                        <button onClick={fetchFeed}>Load Feed</button>
                    </div>
                    <div className="input-container">
                        <input 
                            type="file" 
                            accept=".ansybl" 
                            onChange={handleFileChange} 
                        />
                    </div>
                    
                    {error && <div style={{ color: 'red' }}>{error}</div>}
                    {feed && (
                        <div>
                            <h1>{feed.summary || "Feed"}</h1>
                            <p>Total Posts: {feed.totalItems || feed.items.length}</p>
                            {feed.items.map((item) => (
                                <div key={item.id} className="post">
                                    <h2>{item.name}</h2>
                                    <p>{item.content}</p>
                                    {item.type === "Image" && item.url && (
                                        <img src={item.url} alt={item.name} />
                                    )}
                                    {item.attributedTo && Array.isArray(item.attributedTo) && item.attributedTo.length > 0 && (
                                        <p><em>By: {item.attributedTo[0].name || "Unknown"}</em></p>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById("root")).render(<FeedViewer />);
    </script>
</body>
</html>